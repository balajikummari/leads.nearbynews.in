/* eslint-env browser */
(function () {
    'use strict';
    document.addEventListener('DOMContentLoaded', function () {
        var hamburger = document.querySelector('.js-hamburger');
        var hamburgerMenu = function () {
            document.getElementsByTagName('html')[0].classList.add('is-fixed');
        };
        if (hamburger) {
            hamburger.addEventListener('click', hamburgerMenu, false);
        }
        var closeButton = document.querySelector('.js-close-menu');
        var menuClose = function () {
            document.getElementsByTagName('html')[0].classList.remove('is-fixed');
        };
        if (closeButton) {
            closeButton.addEventListener('click', menuClose, false);
        }
        var progressBar = document.querySelector('.js-slider-bar');
        var duration = 4;
        var interval = 10;
        var percentTime = 0;
        var tick;
        /**
         * Start Progressbar
         */
        function startProgressbar() {
            resetProgressbar();
            percentTime = 0;
            tick = window.setInterval(increase, interval);
        }
        /**
         * Increase function
         */
        function increase() {
            var step = (duration * 1000) / interval;
            percentTime += 100 / step;
            progressBar.style.width = percentTime + '%';
            if (percentTime >= 100) {
                sliderItems.next();
                startProgressbar();
            }
        }
        /**
         * Reset Progressbar
         */
        function resetProgressbar() {
            progressBar.style.width = 0 + '%';
            clearTimeout(tick);
        }
        var mainSlider = document.querySelector('.js-slider');
        if (mainSlider) {
            var sliderItems = new window.Flickity(mainSlider, {
                imagesLoaded: true,
                prevNextButtons: false,
                wrapAround: true,
                draggable: false
            });
            sliderItems.resize();
            startProgressbar();
        }
        var mainSlidernav = document.querySelector('.js-slider-nav');
        if (mainSlidernav) {
            var sliderItemss = new window.Flickity(mainSlidernav, {
                asNavFor: document.querySelector('.js-slider'),
                groupCells: true,
                contain: true,
                imagesLoaded: true,
                prevNextButtons: false,
                pageDots: false
            });
            sliderItemss.resize();

            sliderItemss.on('staticClick', function (event, pointer, cellElement, cellIndex) {
                let target = event.target.closest('.c-slider-nav__items');
                if (target) {
                    if (target.classList.contains('first-click')) {
                        let target_href = target.getAttribute('data-href');
                        location.href = target_href;
                    } else {
                        target.classList.add('first-click');
                    }
                }
            });
        }

        var navHover = document.querySelectorAll('.menu-item-has-children');

        var hoverNav = function (e) {
            // close_all_hover_dropdowns();
            e.target.classList.add('is-hover');
            // e.target.querySelector('.sub-menu').classList.add('has-hover');
        };

        // var hasmenuHover = document.querySelectorAll('.sub-menu');

        var hoverLeave = function (e) {
            e.target.classList.remove('has-hover');
        };

        var navLeave = function (e) {
            e.target.classList.remove('is-hover');
        };

        if (navHover) {
            navHover.forEach(function (item) {
                item.addEventListener('mouseenter', hoverNav);
                item.addEventListener('mouseleave', navLeave);
            });
        }

        // if(hasmenuHover) {
        //   hasmenuHover.forEach(function(item) {
        //     item.addEventListener('mouseleave', hoverLeave);
        //   });
        // }

        function close_all_hover_dropdowns() {
            let has_hover = document.querySelectorAll('.has-hover');
            if (has_hover) {
                has_hover.forEach(function (item) {
                    item.classList.remove('has-hover');
                });
            }

            let is_hover = document.querySelectorAll('.is-hover');
            if (is_hover) {
                has_hover.forEach(function (item) {
                    item.classList.remove('is-hover');
                });
            }

            // document.getElementsByTagName('html')[0].classList.remove('has-overlay');
        }

        window.onclick = function (event) {
            if (!event.target.matches('c-profile')) {
                let profile = document.querySelector('.js-profile');
                if (profile) {
                    if (profile.classList.contains('is-hover')) {
                        profile.classList.remove('is-hover');
                    }

                    let profile_submenu = profile.querySelector('.c-profile__submenu');
                    if (profile_submenu) {
                        if (profile_submenu.classList.contains('has-hover')) {
                            profile_submenu.classList.remove('has-hover');
                            // document.getElementsByTagName('html')[0].classList.remove('has-overlay');
                        }
                    }
                    // console.log(123)
                }
            } else {
                // console.log(321)
            }

        }

        var profileNav = document.querySelector('.js-profile');
        if (profileNav) {
            profileNav.addEventListener('click', function (e) {
                // e.stopPropagation();
                let my_account_link = this.getElementsByTagName('a')[0].getAttribute('href');
                if (window.innerWidth < 740) {
                    if (e.target.nodeName == 'A') {
                        return true;
                    } else if (!profileNav.classList.contains('important-first-click')) {
                        e.preventDefault();
                        this.classList.add('important-first-click');
                    } else {
                        return true;
                    }
                }
            }, true);
        }

        var navProfile = function () {
            close_all_hover_dropdowns();
            profileNav.classList.add('is-hover');
			var hasJsProfileMenu = profileNav.querySelector('.js-profile-menu');
			if(hasJsProfileMenu){
				hasJsProfileMenu.classList.add('has-hover');
			}
            // document.getElementsByTagName('html')[0].classList.add('has-overlay');
        };
        var hasprofileHover = document.querySelector('.js-profile-menu');
        var hoverLeave = function () {
            close_all_hover_dropdowns();
            hasprofileHover.classList.remove('has-hover');
            profileNav.classList.remove('is-hover');
            // document.getElementsByTagName('html')[0].classList.remove('has-overlay');
        };
        if (profileNav) {
            profileNav.addEventListener('mouseenter', navProfile, false);
        }
        if (hasprofileHover) {
            hasprofileHover.addEventListener('mouseleave', hoverLeave, false);
        }



        /**
         * Initial arrow
         * @return {undefined}
         */
        function arrow() {
            var svgURI = 'http://www.w3.org/2000/svg';
            var svg = document.createElementNS(svgURI, 'svg');
            svg.setAttribute('viewBox', '0 0 10.469 18.11');
            svg.setAttribute('width', '10.469');
            svg.setAttribute('xml:space', 'preserve');
            var path = document.createElementNS(svgURI, 'path');
            path.setAttribute('d', 'M1.415 1.414l7.641 7.641-7.641 7.641');
            path.setAttribute('fill', 'none');
            path.setAttribute('stroke', '#707070');
            path.setAttribute('stroke-linecap', 'round');
            path.setAttribute('stroke-width', '2');
            svg.setAttribute('class', 'arrow__btn');
            svg.appendChild(path);
            return svg;
        }
        var watchSlider = document.querySelector('.js-watch');
        if (watchSlider) {
            var sliderWatch = new window.Flickity(watchSlider, {
                imagesLoaded: true,
                pageDots: false,
                groupCells: true,
                contain: true,
                watchCSS: true
            });
            sliderWatch.resize();
        }
        var flickityNext = document
            .querySelector('.js-watch .flickity-prev-next-button.next');
        var flickityPrev = document
            .querySelector('.js-watch .flickity-prev-next-button.previous');
        if (flickityNext) {
            flickityNext.appendChild(arrow());
        }
        if (flickityPrev) {
            flickityPrev.appendChild(arrow());
        }

        var videosSlider = document.querySelectorAll('.js-videos');
        var videoSlide = [];
        for (var i = 0, len = videosSlider.length; i < len; i++) {
            var sliderVideos = videosSlider[i];
            videoSlide[i] = new window.Flickity(sliderVideos, {
                imagesLoaded: true,
                pageDots: false,
                groupCells: true,
                contain: true,
                watchCSS: true
            });
            videoSlide[i].resize();
        }

        var videoNext = document
            .querySelectorAll('.js-videos .flickity-prev-next-button.next');
        for (var j = 0, len = videoNext.length; j < len; j++) {
            videoNext[j].appendChild(arrow());
        }
        var videoPrev = document
            .querySelectorAll('.js-videos .flickity-prev-next-button.previous');
        for (var j = 0, len = videoPrev.length; j < len; j++) {
            videoPrev[j].appendChild(arrow());
        }
        // Preload for images
        var imageWrap = document.querySelector('.js-preload');
        /**
         * Images Item Width function
         */
        function imageItemWidth() {
            var imageItems = document.querySelectorAll('.js-preload-items');
            for (var i = 0; i < imageItems.length; i++) {
                // console.log(imageItems[i].dataset.size.split('x'));
                // console.log('GridWidth:', gridWidth);
                var gridWidth = imageItems[i].offsetWidth;
                var itemSize = imageItems[i].dataset.size.split('x');
                var itemRatio = itemSize[1] / itemSize[0];
                // console.log(itemRatio);
                imageItems[i].style.height = (itemRatio * gridWidth) + 'px';
            }
        }
        if (imageWrap) {
            window.addEventListener('resize', imageItemWidth);
            imageItemWidth();
            // Images Load
            var imageLoaded = window.imagesLoaded(imageWrap);
            imageLoaded.on('progress', function (instance, image) {
                var imageParent = image.img.parentElement;
                if (image.isLoaded) {
                    imageParent.classList.add('is-loaded');
                } else {
                    imageParent.classList.add('is-broken');
                }
            });
        }
        const headerSection = document.querySelector('.js-navigation');
        if (headerSection) {
            let topDistance = headerSection.offsetHeight;
            let viewportWidths = window.innerWidth ||
                document.documentElement.clientWidth;
            /**
             * stickyNavigation function
             */
            function stickyNavigation() {
                let hasBanner = document.querySelector('.has-banner');
                if(hasBanner){
                    if (window.scrollY >= 127) {
                        headerSection.classList.add('js-fixed-nav');
                        if (viewportWidths >= 127) {
                            document.body.style.marginTop = 127 + 'px';
                            headerSection.classList.add('js-fixed-m');
                        }
                        if (window.scrollY >= 2) {
                            document.body.classList.add('js-fixed-animate');
                        }
                    } else {
                        document.body.classList.remove('js-fixed-animate');
                        headerSection.classList.remove('js-fixed-nav');
                        document.body.style.marginTop = 0;
                        headerSection.classList.remove('js-fixed-m');
                    }
                }
                else{
                    if (window.scrollY >= (topDistance + 10)) {
                        headerSection.classList.add('js-fixed-nav');
                        if (viewportWidths >= topDistance) {
                            document.body.style.marginTop = topDistance + 'px';
                        }
                        if (window.scrollY >= 2) {
                            document.body.classList.add('js-fixed-animate');
                        }
                    } else {
                        document.body.classList.remove('js-fixed-animate');
                        headerSection.classList.remove('js-fixed-nav');
                        document.body.style.marginTop = 0;
                    }
                }
            }
            window.addEventListener('scroll', stickyNavigation);
        }
        const postShare = document.querySelector('.js-share');
        /**
         * stickyShare function
         */
        function stickyShare() {
            if (window.scrollY >= 188) {
                document.getElementsByTagName('html')[0].classList.add('has-sticky');
            } else {
                document.getElementsByTagName('html')[0].classList.remove('has-sticky');
            }
        }
        if (postShare) {
            window.addEventListener('scroll', stickyShare);
        }
        const stickySidebar = document.querySelector('.js-sticky-sidebar');
        /**
         * stickyShare function
         */
        function sidebarSticky() {
            if (window.scrollY >= 78) {
                document.getElementsByTagName('html')[0].classList.add('has-sticky-sidebar');
            } else {
                document.getElementsByTagName('html')[0].classList.remove('has-sticky-sidebar');
            }
        }
        if (stickySidebar) {
            window.addEventListener('scroll', sidebarSticky);
        }
        const selectCat = document.querySelectorAll('.js-choice');
        for (var j = 0, len = selectCat.length; j < len; j++) {
            const choices = new Choices(selectCat[j]);
        }
        var peopleCommunity = document.querySelector('.js-people');
        const viewportWidth = window.innerWidth ||
            document.documentElement.clientWidth;
        if (peopleCommunity) {
            var communityPeople = gsap.to('.js-people', { x: -200, duration: 30, ease: "power1.inOut", yoyo: true, repeat: -1 });
            var communityPeoples = gsap.to('.js-peoples', { x: 200, duration: 30, ease: "power1.inOut", yoyo: true, repeat: -1 });
            var personItem = document.querySelectorAll('.js-person');
            var personEnter = function () {
                communityPeople.pause();
                communityPeoples.pause();
            };
            var personLeave = function () {
                communityPeople.play();
                communityPeoples.play();
            };
            for (var j = 0, len = personItem.length; j < len; j++) {
                personItem[j].addEventListener('mouseenter', personEnter, false);
                personItem[j].addEventListener('mouseleave', personLeave, false);
            }
        }
        var mainTestimonial = document.querySelector('.js-testimonial');
        if (mainTestimonial) {
            var testimonialItems = new window.Flickity(mainTestimonial, {
                imagesLoaded: true,
                prevNextButtons: false,
                pageDots: false,
                autoPlay: 3000
            });
            testimonialItems.resize();
        }
        var featureStory = document.querySelector('.js-feature-story');
        if (featureStory) {
            var storyFeature = new window.Flickity(featureStory, {
                imagesLoaded: true,
                prevNextButtons: false,
                pageDots: false,
                watchCSS: true,
                groupCells: true,
                contain: true,
                autoPlay: 3000
            });
            storyFeature.resize();
        }
        // var profileCard = document.querySelector('.js-profile-card');
        // if (profileCard) {
        //     var cardProfile = new window.Flickity(profileCard, {
        //         imagesLoaded: true,
        //         prevNextButtons: false,
        //         pageDots: false,
        //         watchCSS: true,
        //         groupCells: true,
        //         contain: true,
        //         autoPlay: 3000
        //     });
        //     cardProfile.resize();
        // }
        var eventSlider = document.querySelector('.js-events');
        if (eventSlider) {
            var sliderEvents = new window.Flickity(eventSlider, {
                imagesLoaded: true,
                pageDots: false,
                groupCells: true,
                contain: true
            });
            sliderEvents.resize();
        }
        var eventNext = document
            .querySelector('.js-events .flickity-prev-next-button.next');
        var eventPrev = document
            .querySelector('.js-events .flickity-prev-next-button.previous');
        if (eventNext) {
            eventNext.appendChild(arrow());
        }
        if (eventPrev) {
            eventPrev.appendChild(arrow());
        }
        var lectureSlider = document.querySelector('.js-lectures');
        if (lectureSlider) {
            var sliderLecture = new window.Flickity(lectureSlider, {
                imagesLoaded: true,
                pageDots: true,
                groupCells: true,
                contain: true
            });
            sliderLecture.resize();
        }
        var lectureNext = document
            .querySelector('.js-lectures .flickity-prev-next-button.next');
        var lecturePrev = document
            .querySelector('.js-lectures .flickity-prev-next-button.previous');
        if (lectureNext) {
            lectureNext.appendChild(arrow());
        }
        if (lecturePrev) {
            lecturePrev.appendChild(arrow());
        }
        var options = { speed: 1000, easing: 'easeInOutCubic' };
        var scrollEl = document.querySelector('.js-scroll');
        if (scrollEl) {
            var scroll = new window.SmoothScroll('.js-scroll', {
                offset: 0,
                speed: 500,
                updateURL: false
            });
            scroll.animateScroll(options);
        }
        var sidebarBox = document.querySelector('.js-sidebar');
        if (sidebarBox) {
            if (viewportWidth < 980) {
                var msnry = new Masonry(sidebarBox, {
                    // options
                });
            }
        }
        let posts = document.querySelectorAll('.js-interest');
        let loadMoreButton = document.querySelector('.js-more');

        let filter_object = {
            load_more: 12,
            load_more_location: 0
        }

        // Load More
        let setLoadMorePosts = () => {
            let index = 0;
            if (posts.length > filter_object.load_more) {
                for (let post of posts) {
                    post.classList.add('loadmore-included');
                    if (index < filter_object.load_more) {
                        post.classList.add('loadmore-visible');
                    } else {
                        post.hidden = true;
                    }
                    index++;
                }
                filter_object.load_more_location += filter_object.load_more;
                if (loadMoreButton) {
                    loadMoreButton.classList.remove('is-hidden');
                }
            } else {
                if (loadMoreButton) {
                    loadMoreButton.classList.add('is-hidden');
                }
            }
        };
        setLoadMorePosts();
        // Listen for Clicks on Load More button
        if (loadMoreButton) {
            loadMoreButton.addEventListener('click', (e) => {
                e.preventDefault(0);
                let index = 0;
                let IncludedPosts = 0;

                for (let post of posts) {
                    let classList = Object.values(post.classList);
                    if (classList.includes('loadmore-included')) {
                        if (!classList.includes('loadmore-visible')) {
                            if (index < filter_object.load_more) {
                                post.hidden = false;
                                post.classList.add('loadmore-visible');
                                index++;
                            }
                        }
                        IncludedPosts++;
                    }
                }

                filter_object.load_more_location += filter_object.load_more;
                if (IncludedPosts <= filter_object.load_more_location) {
                    loadMoreButton.classList.add('is-hidden');
                }
            });
        }
    });
})();
(function ($) {
    var $preloader_html = '<div class="trends-preloader"><div class="trends-preloader-container"><div class="lds-dual-ring"></div></div></div>';
    const selectCat = document.querySelectorAll('.js-choice-filter');
    const choices = [];
    for (var j = 0, len = selectCat.length; j < len; j++) {
        choices.push(new Choices(selectCat[j], {
            shouldSort: false
        }))
    }
    $(document).on('submit', 'form#search-members', function (e) {
        e.stopPropagation();
        e.preventDefault();

        var $searchKey = $(this).find('input[name="community__search"]').val();
        if($searchKey.length >= 3) {
            profilesOperateRouting($(this), '_search', $searchKey);
        } else {
            alert('Please type at least 3 characters')
        }
        return;

    })
    $( document ).on( 'click', '.trends-add-to-cart-btn', function(e) {
        e.preventDefault();
        var $thisbutton = $(this),
            $product_qty = $thisbutton.attr('data-quantity'),
            $product_id = $thisbutton.attr('data-product_id'),
            $variation_id = $thisbutton.attr('data-variation_id'),
            $switch_subscription = $thisbutton.attr('data-switch-subscription'),
            $switch_item = $thisbutton.attr('data-switch-item');
        if($thisbutton.hasClass('added')) return;

        $thisbutton.parents('.c-product__btn').append('<div class="blockUI blockOverlay" style="z-index: 1000; border: none; margin: 0px; padding: 0px; width: 100%; height: 100%; top: 0px; left: 0px; background-color: rgb(0, 0, 0); opacity: 0.6; cursor: wait; position: absolute;"></div>');

        var data = {
            action: 'woocommerce_ajax_add_to_cart',
            product_id: $product_id,
            product_sku: '',
            quantity: $product_qty,
            variation_id: $variation_id,
            switch_subscription: $switch_subscription,
            switch_item: $switch_item,
        };
        $(document.body).trigger('adding_to_cart', [$thisbutton, data]);
        $.ajax({
            type: 'post',
            url: wc_add_to_cart_params.ajax_url,
            data: data,
            beforeSend: function (response) {
                $thisbutton.addClass('loading');
            },
            complete: function (response) {
                $thisbutton.removeClass('loading');
                $thisbutton.parents('.c-product__btn').find('.blockUI.blockOverlay').remove();
            },
            success: function (response) {
                if (response.error) {
                    alert(response.label);
                    return;
                } else {
                    $thisbutton.addClass('added');
                    $(document.body).trigger('added_to_cart', [response.fragments, response.cart_hash, $thisbutton]);
                }
            },
        });
    });

    $(document).on('click', '#community_profile_list .nav-pagination li a', function (e) {
        e.preventDefault();
        var $this = $(this),
            $page = $this.attr('data-page');

        if(!$page.length) return false;
        setQueryStringParameter('_paged', $page);

        profilesOperateRouting($this, '_paged', $page)

    });

    $(document).on('change', '#community_profile_filters select', function (e) {
        var $this = $(this),
            $thisName = $this.attr('name'),
            $thisSeleted = $this.children('option:selected').val();

        profilesOperateRouting($this, $thisName, $thisSeleted)
    });

    $('#clear-community-filters').on('click', function (e) {
        e.preventDefault();
        e.stopPropagation();
        if(removeURLParameters()) {
            profilesOperateRouting();
            $.each(choices, function (key, choice) {
                choice.setChoiceByValue('');
            });
            $('form#search-members').find('input[name="community__search"]').val('');
        }
    })

    $(window).on('popstate', function(event) {
        profilesOperateRouting();
    });

    function profilesOperateRouting($this, $thisName, $thisValue) {
        removeURLParameters(['_paged']);
        if($this) setQueryStringParameter($thisName, $thisValue);
        var $profileList = $('#community_profile_list');
        if($profileList.length > 0) {

            show_preloader($profileList, true, 'white');
            document.querySelector(".js-form-status").style.display = "none";

            $.ajax({
                url: trends_frontend_params.ajax,
                type: 'POST',
                data: {
                    action: 'load_community_profiles',
                    nonce: trends_frontend_params.nonce,
                    all_params: getQueryParams()

                },
            })
                .always(function (result) {
                    hide_preloader();
                })
                .done(function (result) {
                    if(result.success) {
                        $('.c-section--member .c-section__title').html(result.data.title);
                        $profileList.html(result.data.content);
                        $('html, body').stop().animate({
                            scrollTop: $profileList.offset().top - 300
                        }, 500);
                    } else {
                        document.querySelector(".js-form-status").innerHTML = "Something went wront, please try again later.";
                        document.querySelector(".js-form-status").style.display = "flex";
                    }
                })
                .fail(function () {
                    document.querySelector(".js-form-status").innerHTML =  "Something went wront, please try again later.";
                    document.querySelector(".js-form-status").style.display = "flex";
                });
        }
    }


    function removeURLParameters(removeParams) {
        const params = location.search.slice(1).split('&');

        if(!removeParams) {
            window.history.replaceState({}, document.title, location.pathname + location.hash);
            if(!params.length || !params[0].length) return false;
            return true;
        } else {
            const deleteRegex = new RegExp(removeParams.join('=|') + '=');
            let search = []
            for (let i = 0; i < params.length; i++) if (deleteRegex.test(params[i]) === false) search.push(params[i])
            window.history.replaceState({}, document.title, location.pathname + (search.length ? '?' + search.join('&') : '') + location.hash);
        }
    }

    function setQueryStringParameter(name, value) {
        const params = new URLSearchParams(window.location.search);
        params.set(name, value);
        window.history.pushState({}, "", decodeURIComponent(`${window.location.pathname}?${params}`));
    }

    function getQueryParams() {
        // initialize an empty object
        var result = {};
        // get URL query string
        var params = window.location.search;
        // remove the '?' character
        params = params.substr(1);
        var queryParamArray = params.split('&');
        // iterate over parameter array
        queryParamArray.forEach(function(queryParam) {
            // split the query parameter over '='
            var item = queryParam.split("=");
            result[item[0]] = decodeURIComponent(item[1]);
        });
        // return result object
        return result;
    }

    function show_preloader($element, $show_on_form, $class) {
        $show_on_form = $show_on_form ? $show_on_form : false;
        $class = $class ? $class : '';

        if(!$show_on_form) {
            $element.find('button').append('<div class="trends-overlay ' + $class + '">' + $preloader_html + '</div>');
            $element.find('.trends-preloader').fadeIn(300);
        } else {
            $element.append('<div class="trends-overlay ' + $class + '">' + $preloader_html + '</div>');
            $element.find('.trends-preloader').fadeIn(300);
        }
    }

    function hide_preloader() {
        $('body').find('.trends-overlay').fadeOut(300, function () {
            $(this).remove();
        });
    }

    // Save User email in local storage and paste it in checkout page
    let elementor_form_input = jQuery('.elementor-form input');
    if(elementor_form_input) {
        elementor_form_input.on('change paste keyup', function(e) {
            let user_email = jQuery(this).val();
            localStorage.setItem('user_email',user_email);
        });
    }
})(jQuery)
